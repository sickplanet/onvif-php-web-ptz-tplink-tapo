# Rewrite all requests (except existing files) to index.php for routing
<IfModule mod_rewrite.c>
# Clean, safe rewrite rules for the app.
# Important: Make sure your Apache VirtualHost allows .htaccess (AllowOverride All).

RewriteEngine On

# Dynamically detect base path (works in root or subdirectory)
# Note: RewriteBase is only used when the app is in a subdirectory
# If in root, comment out or remove the RewriteBase line
# RewriteBase /

# If requested path is an existing file or directory, serve it directly.
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Allow direct access to view/external assets (bootstrap, etc.)
RewriteRule ^view/external/ - [L]

# Allow direct access to model/html5_rtsp_player dist/public folders (if you installed submodule)
RewriteRule ^model/html5_rtsp_player/(dist|public)/ - [L]

# Deny direct access to sensitive directories
RewriteRule ^(cfg|ponvif|vendor|model/ponvif)/ - [F,L]

# Route everything else to index.php
RewriteRule ^ index.php [QSA,L]
</IfModule>

# Custom error handling - route errors to index.php with error code as query parameter
# Note: These ErrorDocument directives use relative paths so they work regardless of install location.
# The RewriteRules above should handle most routing, but these are fallbacks for direct Apache errors.
ErrorDocument 400 index.php?error=400
ErrorDocument 401 index.php?error=401
ErrorDocument 403 index.php?error=403
ErrorDocument 404 index.php?error=404
ErrorDocument 500 index.php?error=500